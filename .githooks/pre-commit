#!/bin/bash
# Pre-commit hook: run backend pytest before allowing commit

echo "Running backend tests..."

# Find pytest - check common locations
if command -v pytest &> /dev/null; then
    PYTEST="pytest"
elif [ -x "/opt/anaconda3/bin/pytest" ]; then
    PYTEST="/opt/anaconda3/bin/pytest"
else
    echo "WARNING: pytest not found, skipping tests"
    exit 0
fi

cd "$(git rev-parse --show-toplevel)/backend" || exit 1

$PYTEST tests/ -q --tb=short 2>&1

if [ $? -ne 0 ]; then
    echo ""
    echo "COMMIT BLOCKED: Tests failed. Fix failures before committing."
    exit 1
fi

echo "All tests passed."
